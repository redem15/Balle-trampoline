
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Balle Trampoline – Pelote Jaune & Nuages Chat</title>
<style>
  html, body { margin:0; padding:0; overflow:hidden; background:#87CEEB; }
  canvas { display:block; }
  #score { position:absolute; top:10px; left:10px; font-size:24px; color:#333; font-family:sans-serif; z-index:5; }

  /* Menu et Game Over */
  #menu, #gameOver {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    color:white;
    font-family:sans-serif;
    z-index:10;
    text-align:center;
  }

  #gameTitle { font-size: 60px; margin-bottom: 20px; }
  #bestScoreMenu { font-size: 28px; margin-bottom: 15px; }
  #instructions { font-size: 24px; margin-bottom: 30px; }
  #startBtn { font-size: 36px; padding: 20px 40px; cursor:pointer; border:none; border-radius:10px; background:#33aa33; color:white; font-weight:bold; }
  #startBtn:hover { background:#2d992d; }
  #gameOver button { font-size: 28px; padding: 15px 30px; cursor:pointer; border:none; border-radius:10px; background:#33aa33; color:white; font-weight:bold; }
  #gameOver button:hover { background:#2d992d; }
</style>
</head>
<body>
<div id="score">Score: 0 | Meilleur: 0</div>

<div id="menu">
  <h1 id="gameTitle">Balle Trampoline</h1>
  <p id="bestScoreMenu">Meilleur score : 0</p>
  <p id="instructions">Déplace le trampoline avec la souris pour faire rebondir la balle !</p>
  <button id="startBtn">Jouer</button>
</div>

<div id="gameOver" style="display:none;">
  <h2>Game Over</h2>
  <p id="finalScore"></p>
  <button id="restartBtn">Rejouer</button>
</div>

<canvas id="gameCanvas"></canvas>

<!-- Son de fond -->
<audio id="bgMusic" src="background.mp3" loop autoplay></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDiv = document.getElementById('score');
const menu = document.getElementById('menu');
const gameOverScreen = document.getElementById('gameOver');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const finalScore = document.getElementById('finalScore');
const bestScoreMenu = document.getElementById('bestScoreMenu');
const bgMusic = document.getElementById('bgMusic');

let gameStarted = false;

function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

let ball = { x:0, y:0, radius:30, dx:0, dy:2 };
let trampoline = { width:300, height:20, x:canvas.width/2-150, y:canvas.height-100 };
let score = 0;

// Charger le meilleur score depuis localStorage
let bestScore = localStorage.getItem('bestScore') ? parseInt(localStorage.getItem('bestScore')) : 0;
bestScoreMenu.innerText = `Meilleur score : ${bestScore}`;

// Nuages chats
let clouds = [];
for(let i=0;i<8;i++){
    clouds.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height/2, size:30+Math.random()*50, speed:0.2+Math.random()*0.5 });
}

// Décorations (fleurs et cailloux)
let decorations = [];
function initDecorations(){
    decorations = [];
    for(let i=0;i<30;i++){
        decorations.push({ type: 'flower', x: Math.random()*canvas.width, y: canvas.height - 50 + Math.random()*20, radius: 2 + Math.random()*2, color: `hsl(${Math.random()*60 + 300}, 80%, 60%)` });
    }
    for(let i=0;i<20;i++){
        decorations.push({ type: 'stone', x: Math.random()*canvas.width, y: canvas.height - 50 + Math.random()*20, w: 3 + Math.random()*3, h: 2 + Math.random()*2, color: `hsl(0,0%,${30+Math.random()*20}%)` });
    }
}

function resetBall(){
    ball.x = ball.radius + Math.random()*(canvas.width-2*ball.radius);
    ball.y = ball.radius + Math.random()*(canvas.height/2-ball.radius);
    ball.dx = 0; ball.dy = 2;
}

function drawSky(){
    let topColor = '#87CEEB'; 
    let bottomColor = '#4682B4';
    if(score >= 125){
        topColor = '#5A9BD5'; bottomColor = '#2F5782';
    }
    let grad = ctx.createLinearGradient(0,0,0,canvas.height);
    grad.addColorStop(0, topColor);
    grad.addColorStop(1, bottomColor);
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    clouds.forEach(c=>{
        ctx.fillStyle='rgba(255,255,255,0.45)';
        ctx.shadowColor='rgba(255,255,255,0.6)';
        ctx.shadowBlur=20;
        ctx.beginPath(); ctx.arc(c.x,c.y,c.size,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.moveTo(c.x-c.size*0.6,c.y-c.size*0.2);
        ctx.lineTo(c.x-c.size*0.35,c.y-c.size*0.9); ctx.lineTo(c.x-c.size*0.1,c.y-c.size*0.2); ctx.fill();
        ctx.beginPath(); ctx.moveTo(c.x+c.size*0.6,c.y-c.size*0.2);
        ctx.lineTo(c.x+c.size*0.35,c.y-c.size*0.9); ctx.lineTo(c.x+c.size*0.1,c.y-c.size*0.2); ctx.fill();
        ctx.shadowBlur=0;
        c.x += c.speed; if(c.x-c.size>canvas.width) c.x=-c.size;
    });
}

// Herbe
function drawGrass(){
    let grassHeight = 50;
    for(let i=0; i<canvas.width; i+=2){
        let h = grassHeight + Math.random()*10;
        ctx.beginPath();
        ctx.moveTo(i, canvas.height);
        ctx.lineTo(i+1, canvas.height - h);
        ctx.strokeStyle = `hsl(${100 + Math.random()*30}, 70%, 40%)`;
        ctx.lineWidth = 2;
        ctx.stroke();
    }
}

// Décorations
function drawDecorations(){
    decorations.forEach(d=>{
        if(d.type === 'flower'){
            ctx.beginPath();
            ctx.arc(d.x, d.y, d.radius, 0, Math.PI*2);
            ctx.fillStyle = d.color;
            ctx.fill();
        } else if(d.type === 'stone'){
            ctx.fillStyle = d.color;
            ctx.fillRect(d.x, d.y, d.w, d.h);
        }
    });
}

// Balle pelote
const yarnLines = [];
for(let i=0;i<12;i++){
    yarnLines.push({ a1:Math.random()*Math.PI*2, a2:Math.random()*Math.PI*2, r:20+Math.random()*8 });
}

function drawBall(){
    let color1 = "#FFD700"; // jaune par défaut
    let color2 = null;

    if(score >= 200){
        color1 = "#FF0000"; // rouge
        color2 = "#FFD700"; // jaune
    } else if(score >= 125){
        color1 = "#40E0D0"; // turquoise
    } else if(score >= 75){
        color1 = "#8A2BE2"; // violet
    } else if(score >= 25){
        color1 = "#FF0000"; // rouge
    }

    if(color2){
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, Math.PI/2, Math.PI*3/2);
        ctx.lineTo(ball.x, ball.y);
        ctx.fillStyle = color1;
        ctx.fill();
        ctx.closePath();

        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, Math.PI*3/2, Math.PI/2);
        ctx.lineTo(ball.x, ball.y);
        ctx.fillStyle = color2;
        ctx.fill();
        ctx.closePath();
    } else {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
        ctx.fillStyle = color1;
        ctx.fill();
        ctx.closePath();
    }

    ctx.strokeStyle="rgba(255,255,255,0.6)";
    ctx.lineWidth=2;
    yarnLines.forEach(l=>{
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, l.r, l.a1, l.a2);
        ctx.stroke();
    });
}

// Trampoline réaliste
function drawTrampoline(){
    let bounceEffect = 0;
    if(ball.y + ball.radius > trampoline.y - 10 && ball.x > trampoline.x && ball.x < trampoline.x + trampoline.width){
        let hitPos = (ball.x - (trampoline.x+trampoline.width/2))/(trampoline.width/2);
        bounceEffect = -20 + Math.abs(hitPos)*10;
    }
    ctx.beginPath();
    ctx.moveTo(trampoline.x, trampoline.y + trampoline.height);
    ctx.quadraticCurveTo(trampoline.x+trampoline.width/2, trampoline.y+bounceEffect, trampoline.x+trampoline.width, trampoline.y+trampoline.height);
    let grad = ctx.createLinearGradient(trampoline.x,trampoline.y,trampoline.x,trampoline.y+trampoline.height);
    grad.addColorStop(0, "#66ccff"); grad.addColorStop(1, "#3399ff");
    ctx.fillStyle = grad;
    ctx.fill(); ctx.closePath();

    ctx.lineWidth=6; ctx.strokeStyle="#555";
    ctx.beginPath();
    ctx.moveTo(trampoline.x,trampoline.y+trampoline.height);
    ctx.quadraticCurveTo(trampoline.x+trampoline.width/2,trampoline.y+bounceEffect,trampoline.x+trampoline.width,trampoline.y+trampoline.height);
    ctx.stroke(); ctx.closePath();

    let legHeight=20, legSpacing=30;
    for(let i=0;i<=trampoline.width;i+=legSpacing){
        let x = trampoline.x + i;
        ctx.beginPath(); ctx.moveTo(x,trampoline.y+trampoline.height);
        ctx.lineTo(x,trampoline.y+trampoline.height+legHeight);
        ctx.lineWidth=4; ctx.strokeStyle="#555"; ctx.stroke(); ctx.closePath();
    }
}

// Réduction du trampoline uniquement avant 50 points
function updateTrampolineLength(){
    if(score > 0 && score % 10 === 0 && score < 50){
        trampoline.width /= 1.1;
        if(trampoline.x + trampoline.width > canvas.width) trampoline.x = canvas.width - trampoline.width;
    }
}

// Gestion souris
let isDragging=false;
canvas.addEventListener('mousedown',()=>{isDragging=true;});
canvas.addEventListener('mouseup',()=>{isDragging=false;});
canvas.addEventListener('mouseleave',()=>{isDragging=false;});
canvas.addEventListener('mousemove',e=>{
    if(isDragging){
        const rect=canvas.getBoundingClientRect();
        trampoline.x=e.clientX-rect.left-trampoline.width/2;
        if(trampoline.x<0) trampoline.x=0;
        if(trampoline.x+trampoline.width>canvas.width) trampoline.x=canvas.width-trampoline.width;
    }
});

function updateBestScoreMenu(){ bestScoreMenu.innerText=`Meilleur score : ${bestScore}`; }

function update(){
    if(!gameStarted) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawSky();
    drawGrass();
    drawDecorations();
    drawTrampoline();
    drawBall();

    let gravity = 0.1 + score*0.002;
    if(score >= 10) gravity *= 2;  
    if(score >= 75) gravity *= 2;  

    ball.dy += gravity; ball.x += ball.dx; ball.y += ball.dy;

    if(ball.x-ball.radius<=0){ ball.x=ball.radius; ball.dx=-ball.dx; }
    if(ball.x+ball.radius>=canvas.width){ ball.x=canvas.width-ball.radius; ball.dx=-ball.dx; }

    if(ball.y+ball.radius>=trampoline.y){
        if(ball.x>trampoline.x && ball.x<trampoline.x+trampoline.width){
            ball.y=trampoline.y-ball.radius;
            let targetHeight = canvas.height/2;
            let heightDiff = Math.max(0,trampoline.y-targetHeight);
            ball.dy = -Math.sqrt(2*gravity*heightDiff);
            let hitPos = (ball.x-(trampoline.x+trampoline.width/2))/(trampoline.width/2);
            ball.dx = hitPos*5 + (Math.random()-0.5)*10;
            let accel = 1 + Math.min(score/2000,0.05); ball.dx*=accel; ball.dy*=accel;
            let maxDx=15+Math.floor(score/100); if(ball.dx>maxDx) ball.dx=maxDx; if(ball.dx<-maxDx) ball.dx=-maxDx;
            score++; updateTrampolineLength();
        } else {
            if(score>bestScore){
                bestScore=score;
                localStorage.setItem('bestScore', bestScore); // sauvegarde du meilleur score
            }
            updateBestScoreMenu();
            finalScore.innerText=`Score: ${score} | Meilleur: ${bestScore}`;
            gameOverScreen.style.display='flex';
            gameStarted=false;
            score=0;
            trampoline.width=300; trampoline.x=canvas.width/2-trampoline.width/2;
        }
    }

    scoreDiv.innerText=`Score: ${score} | Meilleur: ${bestScore}`;
    requestAnimationFrame(update);
}

// Initialisation décorations
initDecorations();

startBtn.onclick=()=>{
    menu.style.display='none';
    gameStarted=true;
    resetBall();
    bgMusic.play();
    update();
}

restartBtn.onclick=()=>{
    gameOverScreen.style.display='none';
    gameStarted=true;
    resetBall();
    score=0;
    trampoline.width=300; trampoline.x=canvas.width/2-trampoline.width/2;
    bgMusic.play();
    update();
}
</script>
</body>
</html>
